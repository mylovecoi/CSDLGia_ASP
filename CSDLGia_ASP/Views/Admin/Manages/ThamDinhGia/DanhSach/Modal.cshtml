@{
    var record_hh_id = 1;
    var tdgdmhh = (IEnumerable<ThamDinhGiaDmHh>)ViewData["TdgDmHh"];
    var dvt = (IEnumerable<DmDvt>)ViewData["Dvt"];
}
<!--Create Modal-->
<div class="modal fade" id="Create_Modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="card-label text-dark">
                    Thêm mới thông tin hàng hóa
                </h3>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <i aria-hidden="true" class="ki ki-close"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-xl-3">
                        <div class="form-group fv-plugins-icon-container">
                            <label>Mã hàng hóa*</label>
                            <input type="text" id="mats_create" name="mats_create" class="form-control" />
                        </div>
                    </div>
                    <div class="col-xl-8">
                        <div class="form-group fv-plugins-icon-container">
                            <label>Tên hàng hóa*</label>
                            <input type="text" id="tents_create" name="tents_create" class="form-control" />
                        </div>
                    </div>
                    <div class="col-xl-1">
                        <div class="form-group fv-plugins-icon-container">
                            <label>&nbsp;&nbsp;&nbsp;</label><br />
                            <button type="button" class="btn btn-default" data-target="#Hh_Modal" data-toggle="modal">
                                <i class="la la-plus"></i>
                            </button>
                        </div>
                    </div>
                    <div class="col-xl-6">
                        <div class="form-group fv-plugins-icon-container">
                            <label>Quy cách chất lượng</label>
                            <input type="text" id="qccl_create" name="qccl_create" class="form-control" />
                        </div>
                    </div>
                    <div class="col-xl-6">
                        <div class="form-group fv-plugins-icon-container">
                            <label>Thông số kỹ thuật</label>
                            <input type="text" id="tskt_create" name="tskt_create" class="form-control" />
                        </div>
                    </div>
                    <div class="col-xl-6">
                        <div class="form-group fv-plugins-icon-container">
                            <label>Xuất xứ</label>
                            <input type="text" id="xuatxu_create" name="xuatxu_create" class="form-control" />
                        </div>
                    </div>
                    <div class="col-xl-3">
                        <div class="form-group fv-plugins-icon-container">
                            <label>Đơn vị tính</label>
                            <select id="dvt_create" name="dvt_create" class="form-control">
                                @foreach (var item in dvt)
                                {
                                    <option value="@item.Dvt">@item.Dvt</option>
                                }
                            </select>
                        </div>
                    </div>
                    @* <div class="col-xl-1">
                        <div class="form-group fv-plugins-icon-container">
                            <label>&nbsp;&nbsp;&nbsp;</label><br />
                            <button type="button" class="btn btn-default" data-target="#Dvt_Modal" data-toggle="modal">
                                <i class="la la-plus"></i>
                            </button>
                        </div>
                    </div> *@
                    <div class="col-xl-3">
                        <div class="form-group fv-plugins-icon-container">
                            <label>Số lượng</label>
                            <input type="number" id="sl_create" name="sl_create" class="form-control" />
                        </div>
                    </div>
                    <div class="col-xl-3">
                        <div class="form-group fv-plugins-icon-container">
                            <label>Đơn giá đề nghị*</label>
                            <input type="text" id="nguyengiadenghi_create" name="nguyengiadenghi_create" class="form-control money text-right" style="font-weight: bold" />
                        </div>
                    </div>
                    <div class="col-xl-3">
                        <div class="form-group fv-plugins-icon-container">
                            <label>Giá trị đề nghị*</label>
                            <input type="text" id="giadenghi_create" name="giadenghi_create" class="form-control money text-right" style="font-weight: bold" />
                        </div>
                    </div>
                    <div class="col-xl-3">
                        <div class="form-group fv-plugins-icon-container">
                            <label>Đơn giá thẩm định*</label>
                            <input type="text" id="nguyengiathamdinh_create" name="nguyengiathamdinh_create" class="form-control money text-right" style="font-weight: bold" />
                        </div>
                    </div>
                    <div class="col-xl-3">
                        <div class="form-group fv-plugins-icon-container">
                            <label>Giá trị tài sản thẩm định*</label>
                            <input type="text" id="giatritstd_create" name="giatritstd_create" class="form-control money text-right" style="font-weight: bold" />
                        </div>
                    </div>
                    <div class="col-xl-12">
                        <div class="form-group fv-plugins-icon-container">
                            <label>Ghi chú</label>
                            <textarea type="text" id="ghichu_create" name="ghichu_create" cols="12" rows="2" class="form-control"></textarea>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-light-danger font-weight-bold" data-dismiss="modal">Đóng</button>
                <button type="button" class="btn btn-primary font-weight-bold" onclick="SetStore()">Thêm mới</button>
            </div>
        </div>
    </div>
</div>

<!--Edit Modal-->
<div class="modal fade" id="Edit_Modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="card-label text-dark">
                    Chỉnh sửa thông tin hàng hóa
                </h3>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <i aria-hidden="true" class="ki ki-close"></i>
                </button>
            </div>
            <div class="modal-body" id="edit_thongtin">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-light-danger font-weight-bold" data-dismiss="modal">Hủy thao tác</button>
                <button type="button" class="btn btn-primary font-weight-bold" onclick="SetUpdate()">Cập nhật</button>
            </div>
        </div>
    </div>
</div>

<!--Delete Modal-->
<div class="modal fade" id="Delete_Modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="card-label text-dark">
                    Đồng ý xóa thông tin???
                </h3>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <i aria-hidden="true" class="ki ki-close"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="row text-left">
                    <input hidden id="id_delete" name="id_delete" />
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-light-danger font-weight-bold" data-dismiss="modal">Đóng</button>
                <button type="button" class="btn btn-primary font-weight-bold" onclick="SetDelete()">Đồng ý</button>
            </div>
        </div>
    </div>
</div>

<!--Hh Modal-->
<div class="modal fade" id="Hh_Modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="card-label">
                    Danh mục hàng hóa
                </h3>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <i aria-hidden="true" class="ki ki-close"></i>
                </button>
            </div>
            <hr />
            <div class="modal-body">
                <table class="table table-striped table-bordered table-hover" id="sample_3">
                    <thead>
                        <tr style="text-align:center">
                            <th width="4%">#</th>
                            <th>Mã số</th>
                            <th>Tên hàng hóa</th>
                            <th>Thông số kỹ thuật</th>
                            <th>Xuất xứ</th>
                            <th>Đơn vị tính</th>
                            <th>Thao tác</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (tdgdmhh != null)
                        {
                            @foreach (var hh in tdgdmhh)
                            {
                                <tr id="hh_@hh.Id">
                                    <td style="text-align: center">@(record_hh_id++)</td>
                                    <td class="active">@hh.Mahanghoa</td>
                                    <td class="success" style="font-weight: bold">@hh.Tenhanghoa</td>
                                    <td>@hh.Thongsokt</td>
                                    <td>@hh.Xuatxu</td>
                                    <td style="text-align: center">@hh.Dvt</td>
                                    <td style="text-align: center">
                                        <button type="button" class="btn btn-sm btn-clean btn-icon" title="Chọn" onclick="addhh('hh_@hh.Id')">
                                            <i class="icon-lg la la-check text-primary"></i>
                                        </button>
                                    </td>
                                </tr>
                            }
                        }
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-light-danger font-weight-bold" data-dismiss="modal">Hủy</button>
            </div>
        </div>
    </div>
</div>

<!--Dvt Modal-->
<div class="modal fade" id="Dvt_Modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="card-label">
                    Thông tin đơn vị tính
                    <span class="d-block text-muted pt-2 font-size-sm">Thêm mới đơn vị tính</span>
                </h3>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <i aria-hidden="true" class="ki ki-close"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-xl-12">
                        <div class="form-group fv-plugins-icon-container">
                            <label>Đơn vị tính*</label>
                            <input class="form-control" id="dvt_add" name="dvt_add" />
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-light-danger font-weight-bold" data-dismiss="modal">Hủy thao tác</button>
                <button type="button" class="btn btn-primary font-weight-bold" onclick="Dvt()">Đồng ý</button>
            </div>
        </div>
    </div>
</div>

<!--Hh Edit Modal-->
<div class="modal fade" id="Hh_Edit_Modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="card-label">
                    Danh mục hàng hóa
                </h3>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <i aria-hidden="true" class="ki ki-close"></i>
                </button>
            </div>
            <hr />
            <div class="modal-body">
                <table class="table table-striped table-bordered table-hover" id="sample_3">
                    <thead>
                        <tr style="text-align:center">
                            <th width="4%">#</th>
                            <th>Mã số</th>
                            <th>Tên hàng hóa</th>
                            <th>Thông số kỹ thuật</th>
                            <th>Xuất xứ</th>
                            <th>Đơn vị tính</th>
                            <th>Thao tác</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (tdgdmhh != null)
                        {
                            @foreach (var hh in tdgdmhh)
                            {
                                <tr id="hh_edit_@hh.Id">
                                    <td style="text-align: center">@(record_hh_id++)</td>
                                    <td class="active">@hh.Mahanghoa</td>
                                    <td class="success" style="font-weight: bold">@hh.Tenhanghoa</td>
                                    <td>@hh.Thongsokt</td>
                                    <td>@hh.Xuatxu</td>
                                    <td style="text-align: center">@hh.Dvt</td>
                                    <td style="text-align: center">
                                        <button type="button" class="btn btn-sm btn-clean btn-icon" title="Chọn" onclick="addhhedit('hh_edit_@hh.Id')">
                                            <i class="icon-lg la la-check text-primary"></i>
                                        </button>
                                    </td>
                                </tr>
                            }
                        }
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-light-danger font-weight-bold" data-dismiss="modal">Hủy</button>
            </div>
        </div>
    </div>
</div>

<!--Dvt Edit Modal-->
<div class="modal fade" id="Dvt_Edit_Modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="card-label">
                    Thông tin đơn vị tính
                    <span class="d-block text-muted pt-2 font-size-sm">Thêm mới đơn vị tính</span>
                </h3>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <i aria-hidden="true" class="ki ki-close"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-xl-12">
                        <div class="form-group fv-plugins-icon-container">
                            <label>Đơn vị tính*</label>
                            <input class="form-control" id="dvt_add_edit" name="dvt_add_edit" />
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-light-danger font-weight-bold" data-dismiss="modal">Hủy thao tác</button>
                <button type="button" class="btn btn-primary font-weight-bold" onclick="DvtEdit()">Đồng ý</button>
            </div>
        </div>
    </div>
</div>

<script>
    function addhh(mahh) {
        var element = document.getElementById(mahh);
        $('#mats_create').val(element.cells.item(1).innerText);
        $('#tents_create').val(element.cells.item(2).innerText);
        $('#tskt_create').val(element.cells.item(3).innerText);
        $('#xuatxu_create').val(element.cells.item(4).innerText);
        $('#dvt_create').val(element.cells.item(5).innerText).trigger('change');
        $('#Hh_Modal').modal('hide');
    }
    
    function addhhedit(mahh) {
        var element = document.getElementById(mahh);
        $('#mats_edit').val(element.cells.item(1).innerText);
        $('#tents_edit').val(element.cells.item(2).innerText);
        $('#tskt_edit').val(element.cells.item(3).innerText);
        $('#xuatxu_edit').val(element.cells.item(4).innerText);
        $('#dvt_edit').val(element.cells.item(5).innerText).trigger('change');
        $('#Hh_Edit_Modal').modal('hide');
    }

    function Dvt() {
        if ($('#dvt_add').val().trim() == '') {
            toastr.error("Đơn vị tính không được để trống!!!", "Lỗi!");
        } else {
            $('#Dvt_Modal').modal('hide');
            var gt = $('#dvt_add').val();
            $('#dvt_create').append(new Option(gt, gt, true, true));
            $('#dvt_create').val(gt).trigger('change');
        }
    }
    
    function DvtEdit() {
        if ($('#dvt_add_edit').val().trim() == '') {
            toastr.error("Đơn vị tính không được để trống!!!", "Lỗi!");
        } else {
            $('#Dvt_Edit_Modal').modal('hide');
            var gt = $('#dvt_add_edit').val();
            $('#dvt_edit').append(new Option(gt, gt, true, true));
            $('#dvt_edit').val(gt).trigger('change');
        }
    }

    function SetStore() {
        if ($('#mats_create').val().trim() == '') {
            toastr.error("Mã hàng hóa không được để trống!!!", "Lỗi!");
        } else {
            if ($('#tents_create').val().trim() == '') {
                toastr.error("Tên hàng hóa không được để trống!!!", "Lỗi!");
            } else {
                if ($('#sl_create').val() < 1) {
                    toastr.error("Số lượng phải lớn hơn 0!!!", "Lỗi!");
                } else {
                    if ($('#nguyengiadenghi_create').val().trim() == '') {
                        toastr.error("Đơn giá đề nghị không được để trống!!!", "Lỗi!");
                    } else {
                        if ($('#giadenghi_create').val().trim() == '') {
                            toastr.error("Giá trị đề nghị không được để trống!!!", "Lỗi!");
                        } else {
                            if ($('#nguyengiathamdinh_create').val().trim() == '') {
                                toastr.error("Đơn giá thẩm định không được để trống!!!", "Lỗi!");
                            } else {
                                if ($('#giatritstd_create').val().trim() == '') {
                                    toastr.error("Giá trị tài sản thẩm định không được để trống!!!", "Lỗi!");
                                } else {
                                    $.ajax({
                                        url: '/ThamDinhGiaCt/Store',
                                        type: 'POST',
                                        data: {
                                            Mahs: $('#Mahs').val(),
                                            Mats: $('#mats_create').val(),
                                            Tents: $('#tents_create').val(),
                                            Qccl: $('#qccl_create').val(),
                                            Tskt: $('#tskt_create').val(),
                                            Xuatxu: $('#xuatxu_create').val(),
                                            Dvt: $('#dvt_create').val(),
                                            Sl: $('#sl_create').val(),
                                            Ngiadn: $('#nguyengiadenghi_create').val(),
                                            Giadn: $('#giadenghi_create').val(),
                                            Ngiatd: $('#nguyengiathamdinh_create').val(),
                                            Giatd: $('#giatritstd_create').val(),
                                            Ghichu: $('#ghichu_create').val(),
                                        },
                                        dataType: 'JSON',
                                        success: function (data) {
                                            if (data.status == 'success') {
                                                toastr.success("Cập nhật thông tin thành công!", "Thành công");
                                                $('#frm_data').replaceWith(data.message);
                                                $(document).ready(function () {
                                                    TableManaged4.init();
                                                });
                                                $('#Create_Modal').modal("hide");
                                            } else {
                                                toastr.error(data.message, "Lỗi!");
                                            }
                                        }
                                    })
                                }
                            }
                        }
                    }
                }
            }
        }
    }

    function SetEdit(id_edit) {
        $.ajax({
            url: '/ThamDinhGiaCt/Edit',
            type: 'POST',
            data: {
                Id: id_edit
            },
            dataType: 'JSON',
            success: function (data) {
                if (data.status == 'success') {
                    toastr.success("Success!");
                    $('#edit_thongtin').replaceWith(data.message);
                    MoneyMask();
                } else {
                    toastr.error(data.message, "Lỗi!!!");
                }
            }
        })
    }

    function SetUpdate() {
        if ($('#mats_edit').val().trim() == '') {
            toastr.error("Mã hàng hóa không được để trống!!!", "Lỗi!");
        } else {
            if ($('#tents_edit').val().trim() == '') {
                toastr.error("Tên hàng hóa không được để trống!!!", "Lỗi!");
            } else {
                if ($('#sl_edit').val() < 1) {
                    toastr.error("Số lượng phải lớn hơn 0!!!", "Lỗi!");
                } else {
                    if ($('#nguyengiadenghi_edit').val().trim() == '') {
                        toastr.error("Đơn giá đề nghị không được để trống!!!", "Lỗi!");
                    } else {
                        if ($('#giadenghi_edit').val().trim() == '') {
                            toastr.error("Giá trị đề nghị không được để trống!!!", "Lỗi!");
                        } else {
                            if ($('#nguyengiathamdinh_edit').val().trim() == '') {
                                toastr.error("Đơn giá thẩm định không được để trống!!!", "Lỗi!");
                            } else {
                                if ($('#giatritstd_edit').val().trim() == '') {
                                    toastr.error("Giá trị tài sản thẩm định không được để trống!!!", "Lỗi!");
                                } else {
                                    var ngiadn = $('#nguyengiadenghi_edit').val().replace(',', '');
                                    var giadn = $('#giadenghi_edit').val().replace(',', '');
                                    var ngiatd = $('#nguyengiathamdinh_edit').val().replace(',', '');
                                    var giatd = $('#giatritstd_edit').val().replace(',', '');
                                    $.ajax({
                                        url: '/ThamDinhGiaCt/Update',
                                        type: 'POST',
                                        data: {
                                            Mats: $('#mats_edit').val(),
                                            Tents: $('#tents_edit').val(),
                                            Qccl: $('#qccl_edit').val(),
                                            Tskt: $('#tskt_edit').val(),
                                            Xuatxu: $('#xuatxu_edit').val(),
                                            Dvt: $('#dvt_edit').val(),
                                            Sl: $('#sl_edit').val(),
                                            Ngiadn: ngiadn,
                                            Giadn: giadn,
                                            Ngiatd: ngiatd,
                                            Giatd: giatd,
                                            Ghichu: $('#ghichu_edit').val(),
                                            Id: $('#id_edit').val()
                                        },
                                        dataType: 'JSON',
                                        success: function (data) {
                                            if (data.status == 'success') {
                                                toastr.success("Cập nhật thông tin thành công!", "Thành công");
                                                $('#frm_data').replaceWith(data.message);
                                                $(document).ready(function () {
                                                    TableManaged4.init();
                                                });
                                                $('#Edit_Modal').modal("hide");
                                            } else {
                                                toastr.error(data.message, "Lỗi!");
                                            }
                                        }
                                    })
                                }
                            }
                        }
                    }
                }
            }
        }
    }

    function GetDelete(id) {
        document.getElementById("id_delete").value = id;
    }

    function SetDelete() {
        $.ajax({
            url: '/ThamDinhGiaCt/Delete',
            type: 'POST',
            data: {
                Id: $('#id_delete').val(),
            },
            dataType: 'JSON',
            success: function (data) {
                if (data.status == 'success') {
                    $('#frm_data').replaceWith(data.message);
                    $(document).ready(function () {
                        TableManaged4.init();
                    });
                    toastr.success("Cập nhật thành công!!!", "Thành công!");
                    $('#Delete_Modal').modal("hide");
                } else {
                    toastr.error(data.message, "Lỗi!");
                }
            }
        })
    }

</script>