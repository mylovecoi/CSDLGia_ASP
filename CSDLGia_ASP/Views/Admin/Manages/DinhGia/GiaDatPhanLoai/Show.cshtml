@{
    Layout = "_LayoutReports";
    var dsdiaban = (IEnumerable<DsDiaBan>)ViewData["DsDiaBan"];
    int record_id = 1;
    var dsdonvi = (IEnumerable<DsDonVi>)ViewData["DsDonVi"];
    var dmloaidat = (IEnumerable<DmLoaiDat>)ViewData["Dmloaidat"];
    var DsXaPhuong = (IEnumerable<DsXaPhuong>)ViewData["DsXaPhuong"];
}
<br />
<br />
@model CSDLGia_ASP.ViewModels.Manages.DinhGia.VMDinhGiaDat

<p style="text-align: center; font-weight: bold; font-size: 30px;">THÔNG TIN HỒ SƠ</p>
<p style="text-align: left; font-size: 16px;">Số quyết định: @Model.Soqd</p>
<p style="text-align: left; font-size: 16px;">
    Địa bàn:
    @foreach (var ds in dsdiaban)
    {
        @if (Model.Madiaban == ds.MaDiaBan)
        {
            @ds.TenDiaBan
        }
    }
</p>
<p style="text-align: left; font-size: 16px;">Thời điểm: @Helpers.ConvertDateToStr(Model.Thoidiem)</p>
<p style="text-align: left; font-size: 16px;">
    Cơ quan tiếp nhận:
    @foreach (var dsonvi in dsdonvi)
    {
        @if (Model.Macqcq == dsonvi.MaDv)
        {
            @dsonvi.TenDv
        }
    }
</p>
<p style="text-align: left; font-size: 16px;">Phân loại hồ sơ: @Model.Phanloai </p>

<br />
<p style="color: blue; text-decoration-line: underline; font-weight: bold">Thông tin hồ sơ chi tiết</p>
<table cellspacing="0" cellpadding="0" border="1" style="margin: 20px auto; border-collapse: collapse;font:normal 14px Times, serif;" id="data">

    <thead>
        <tr>
            <th style="text-align:center;">STT</th>            
            <th style="text-align:center;">Tên đường, giới hạn, khu vực</th>
            <th style="text-align:center;">Giá đất cụ thể</th>
        </tr>
    </thead>
    <tbody>
        @if (Model.GiaDatPhanLoaiCt.Any())
        {
            @foreach (var diaban in dsdiaban)
            {
                var dataDiaBan = Model.GiaDatPhanLoaiCt.Where(x=>x.MaDiaBan == diaban.MaDiaBan);
                if (dataDiaBan.Any())
                {
                    var dataAllXa = dataDiaBan.Where(x=>x.MaXaPhuong=="all"|| string.IsNullOrEmpty(x.MaXaPhuong));
                    <tr>
                        <td colspan="3" style="text-align:left; font-weight:bold;">@diaban.TenDiaBan</td>
                    </tr>
                    if (dataAllXa.Any())
                    {
                        @foreach (var allXa in dataAllXa)
                        {
                            <tr style="text-align:center">
                                <td style="text-align:center">@(record_id++)</td>
                                <td style="text-align:left"> @allXa.Khuvuc</td>
                                <td style="text-align:right;">@Helpers.ConvertDbToStr(allXa.Giacuthe)</td>
                            </tr>
                        }
                    }
                    @foreach (var xa in DsXaPhuong)
                    {
                        var data = dataDiaBan.Where(x => x.MaXaPhuong == xa.Maxp);                        
                        if (data.Any())
                        {
                            <tr>
                                <td colspan="3" style="text-align:left; font-weight:bold;"> &emsp; @xa.Tenxp</td>
                            </tr>
                            @foreach (var item in data)
                            {
                                <tr style="text-align:center">
                                    <td style="text-align:center">@(record_id++)</td>
                                    <td style="text-align:left"> @item.Khuvuc</td>
                                    <td style="text-align:right;">@Helpers.ConvertDbToStr(item.Giacuthe)</td>
                                </tr>
                            }
                        }
                    }
                }

            }    
        }
    </tbody>
</table>
