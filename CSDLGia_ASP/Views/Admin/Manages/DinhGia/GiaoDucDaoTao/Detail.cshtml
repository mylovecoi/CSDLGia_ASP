@{
    int record_id = 1;
    var GiaDvGdDtDm = (IEnumerable<GiaDvGdDtDm>)ViewData["GiaDvGdDtDm"];
}
<div class="mb-3 font-weight-bold font-size-lg">
    <label style="color: blue; text-decoration-line: underline; font-weight: bold">Thông tin hồ sơ chi tiết</label>
</div>
<div class="card card-custom" style="border: 1px solid #60aee4;">
    <div class="card-header flex-wrap border-0 pt-6 pb-0">
        <div class="card-title">
            <h3 class="card-label">
            </h3>
        </div>
        <div class="card-toolbar">
            <button type="button" data-target="#Create_Modal" data-toggle="modal"
                    class="btn btn-primary font-weight-bolder" title="Create">
                <i class="la la-plus"></i>Thêm mới
            </button>
        </div>
    </div>
    <hr />
    <div class="card-body" id="frm_data">
        <table class="table table-striped table-bordered table-hover" id="datatable_4">
            <thead>
                <tr style="text-align:center">
                    <th rowspan="2">STT</th>
                    <th rowspan="2">Tên sản phẩm <br />dịch vụ</th>
                    <td colspan="4">Mức thu học phí 1</td>
                    <td colspan="4">Mức thu học phí 2</td>
                    <td colspan="4">Mức thu học phí 3</td>
                    <th rowspan="2">Thao<br /> tác</th>
                </tr>
                <tr>
                    <th>Năm <br /> học</th>
                    <th>Thành<br /> thị</th>
                    <th>Nông<br /> thôn</th>
                    <th>Miền<br /> núi</th>

                    <th>Năm<br /> học</th>
                    <th>Thành<br /> thị</th>
                    <th>Nông<br /> thôn</th>
                    <th>Miền<br /> núi</th>

                    <th>Năm<br /> học</th>
                    <th>Thành<br /> thị</th>
                    <th>Nông<br /> thôn</th>
                    <th>Miền<br /> núi</th>
                </tr>
            </thead>
            <tbody>
                @if (Model != null)
                {
                    @if (Model.GiaDvGdDtCt != null)
                    {
                        @foreach (var item in Model.GiaDvGdDtCt)
                        {
                            <tr>
                                <td style="text-align:center">@(record_id++)</td>
                                <td style="text-align:left">
                                    @if (GiaDvGdDtDm != null)
                                    {
                                        @foreach (var dm in GiaDvGdDtDm)
                                        {
                                            @if (item.Maspdv == dm.Maspdv)
                                            {
                                                <span>@dm.Tenspdv</span>
                                            }
                                        }
                                    }
                                </td>


                                <td>@item.Namapdung1</td>
                                <td>@item.Giathanhthi1</td>
                                <td>@item.Gianongthon1</td>
                                <td>@item.Giamiennui1</td>

                                <td>@item.Namapdung2</td>
                                <td>@item.Giathanhthi2</td>
                                <td>@item.Gianongthon2</td>
                                <td>@item.Giamiennui2</td>

                                <td>@item.Namapdung3</td>
                                <td>@item.Giathanhthi3</td>
                                <td>@item.Gianongthon3</td>
                                <td>@item.Giamiennui3</td>


                                <td>
                                    <button type="button"
                                onclick="SetEdit(@item.Id)" class="btn btn-sm btn-clean btn-icon" title="Chỉnh sửa">
                                        <i class="icon-lg la la-edit text-primary"></i>
                                    </button>
                                    <button type="button" data-target="#Delete_Modal" data-toggle="modal"
                                onclick="GetDelete(@item.Id)" class="btn btn-sm btn-clean btn-icon" title="Xóa">
                                        <i class="icon-lg la la-trash text-danger"></i>
                                    </button>
                                </td>
                            </tr>
                        }
                    }
                }
            </tbody>
        </table>
        <!--end: Datatable-->
    </div>
</div>


<!--Edit Modal-->
<div class="modal fade" id="Edit_Modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="card-label text-dark">
                    Chỉnh sửa thông tin giá
                </h3>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <i aria-hidden="true" class="ki ki-close"></i>
                </button>
            </div>
            <div class="modal-body" id="edit_thongtin">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-light-danger font-weight-bold" data-dismiss="modal">Hủy thao tác</button>
                <button type="button" class="btn btn-primary font-weight-bold" onclick="SetUpdate()">Cập nhật</button>
            </div>
        </div>
    </div>
</div>

<!--Delete Modal-->
<div class="modal fade" id="Delete_Modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="card-label text-dark">
                    Đồng ý xóa thông tin???
                </h3>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <i aria-hidden="true" class="ki ki-close"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="row text-left">
                    <input id="id_delete" name="id_delete" />
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-light-danger font-weight-bold" data-dismiss="modal">Đóng</button>
                <button type="button" class="btn btn-primary font-weight-bold" onclick="SetDelete()">Đồng ý</button>
            </div>
        </div>
    </div>
</div>


<!--Create Modal-->
<div class="modal fade" id="Create_Modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="card-label text-dark">
                    Thông tin chi tiết hồ sơ
                </h3>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <i aria-hidden="true" class="ki ki-close"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <input id="Mahs_create" name="Mahs_create" value="@ViewData["Mahs"]" />
                    <div class="col-xl-12">
                        <div class="form-group fv-plugins-icon-container">
                            <label><b>Tên sản phẩm dịch vụ</b></label>
                            <select id="Maspdv_create" name="Maspdv_create" class="form-control">
                                @foreach (var item in GiaDvGdDtDm)
                                {
                                    <option value="@item.Maspdv">@item.Tenspdv</option>
                                }
                            </select>

                        </div>
                    </div>

                    <div class="col-xl-3">
                        <div class="form-group fv-plugins-icon-container">
                            <label><b>Năm áp dụng 1</b></label>
                            <input type="text" id="nam1_create" name="nam1_create" class="form-control" />
                        </div>
                    </div>
                    <div class="col-xl-3">
                        <div class="form-group fv-plugins-icon-container">
                            <label><b>Khu vực thành thị</b></label>
                            <input type="text" id="tt1_create" name="tt1_create" class="form-control money text-right" style="font-weight: bold" />
                        </div>
                    </div>
                    <div class="col-xl-3">
                        <div class="form-group fv-plugins-icon-container">
                            <label><b>Khu vực nông thôn</b></label>
                            <input type="text" id="nt1_create" name="nt1_create" class="form-control money text-right" style="font-weight: bold" />
                        </div>
                    </div>
                    <div class="col-xl-3">
                        <div class="form-group fv-plugins-icon-container">
                            <label><b>Khu vực miền núi</b></label>
                            <input type="text" id="mn1_create" name="mn1_create" class="form-control money text-right" style="font-weight: bold" />
                        </div>
                    </div>




                    <div class="col-xl-3">
                        <div class="form-group fv-plugins-icon-container">
                            <label><b>Năm áp dụng 2</b></label>
                            <input type="text" id="nam2_create" name="nam2_create" class="form-control" />
                        </div>
                    </div>
                    <div class="col-xl-3">
                        <div class="form-group fv-plugins-icon-container">
                            <label><b>Khu vực thành thị</b></label>
                            <input type="text" id="tt2_create" name="tt2_create" class="form-control money text-right" style="font-weight: bold" />
                        </div>
                    </div>
                    <div class="col-xl-3">
                        <div class="form-group fv-plugins-icon-container">
                            <label><b>Khu vực nông thôn</b></label>
                            <input type="text" id="nt2_create" name="nt2_create" class="form-control money text-right" style="font-weight: bold" />
                        </div>
                    </div>
                    <div class="col-xl-3">
                        <div class="form-group fv-plugins-icon-container">
                            <label><b>Khu vực miền núi</b></label>
                            <input type="text" id="mn2_create" name="mn2_create" class="form-control money text-right" style="font-weight: bold" />
                        </div>
                    </div>


                    <div class="col-xl-3">
                        <div class="form-group fv-plugins-icon-container">
                            <label><b>Năm áp dụng 3</b></label>
                            <input type="text" id="nam3_create" name="nam3_create" class="form-control" />
                        </div>
                    </div>
                    <div class="col-xl-3">
                        <div class="form-group fv-plugins-icon-container">
                            <label><b>Khu vực thành thị</b></label>
                            <input type="text" id="tt3_create" name="tt3_create" class="form-control money text-right" style="font-weight: bold" />
                        </div>
                    </div>
                    <div class="col-xl-3">
                        <div class="form-group fv-plugins-icon-container">
                            <label><b>Khu vực nông thôn</b></label>
                            <input type="text" id="nt3_create" name="nt3_create" class="form-control money text-right" style="font-weight: bold" />
                        </div>
                    </div>
                    <div class="col-xl-3">
                        <div class="form-group fv-plugins-icon-container">
                            <label><b>Khu vực miền núi</b></label>
                            <input type="text" id="mn3_create" name="mn3_create" class="form-control money text-right" style="font-weight: bold" />
                        </div>
                    </div>

                </div>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-light-danger font-weight-bold" data-dismiss="modal">Đóng</button>
                <button type="button" class="btn btn-primary font-weight-bold" onclick="SetStoreCt()">Thêm mới</button>
            </div>
        </div>
    </div>
</div>

<script>

    function SetStoreCt() {
        $.ajax({
            url: '/DinhGiaGdDtCt/Store',
            type: 'POST',
            data: {
                Mahs: $('#Mahs_create').val(),
                Maspdv: $('#Maspdv_create').val(),

                Namapdung1: $('#nam1_create').val(),
                Thanhthi1: $('#tt1_create').val(),
                Nongthon1: $('#nt1_create').val(),
                Miennui1: $('#mn1_create').val(),

                Namapdung2: $('#nam2_create').val(),
                Thanhthi2: $('#tt2_create').val(),
                Nongthon2: $('#nt2_create').val(),
                Miennui2: $('#mn2_edit').val(),

                Namapdung3: $('#nam3_create').val(),
                Thanhthi3: $('#tt3_create').val(),
                Nongthon3: $('#nt3_create').val(),
                Miennui3: $('#mn3_create').val(),
            },
            dataType: 'JSON',
            success: function(data) {
                if (data.status == 'success') {
                    toastr.success("Cập nhật thông tin thành công!", "Thành công");
                    $('#frm_data').replaceWith(data.message);
                    $(document).ready(function() {
                        TableManaged4.init();
                    });
                    $('#Create_Modal').modal("hide");
                }
                else if (data.status == 'success2') {
                    toastr.error("sản phẩm dịch vụ không có trong danh sách!", "không tồn tại");
                    $('#frm_data').replaceWith(data.message);
                    $(document).ready(function() {
                        TableManaged4.init();
                    });
                    $('#Create_Modal').modal("hide");
                }
                else {
                    toastr.error(data.message, "Lỗi!");

                }
            }
        })

    }


    function SetEdit(id_edit ) {
        if ($('#Tunam').val().trim() == "") {
            toastr.error("Lộ trình từ năm không được để trống!", "Lỗi!!!")
            $('#Tunam').focus();
        }
        else {
            if ($('#Dennam').val().trim() == "") {
                toastr.error("Lộ trình đến năm không được để trống!", "Lỗi!!!")
                $('#Dennam').focus();
            } else {
                if ($('#Tunam').val().trim() > $('#Dennam').val().trim()) {
                    toastr.error("Thời gian từ không được lớn hơn thời gian đến!", "Lỗi!!!")
                }
                else {
                     
                    $.ajax({
                        url: '/DinhGiaGdDtCt/Edit',
                        type: 'POST',
                        data: {
                            Id: id_edit,
                            tunam: $('#Tunam').val(),
                            dennam: $('#Dennam').val(),
                        },
                        dataType: 'JSON',
                        success: function(data) {

                            if (data.status == 'success') {
                                toastr.success("Success!");
                                $('#edit_thongtin').replaceWith(data.message);
                                  $('#Edit_Modal').modal();
                            } else {
                                toastr.error(data.message, "Lỗi!!!");

                            }
                        }
                    })
                }
            }
        }

    }

    function SetUpdate() {

        $.ajax({
            url: '/DinhGiaGdDtCt/Update',
            type: 'POST',
            data: {
                Maspdv: $('#Maspdv_create').val(),

                Namapdung1: $('#nam1_edit').val(),
                Thanhthi1: $('#tt1_edit').val(),
                Nongthon1: $('#nt1_edit').val(),
                Miennui1: $('#mn1_edit').val(),

                Namapdung2: $('#nam2_edit').val(),
                Thanhthi2: $('#tt2_edit').val(),
                Nongthon2: $('#nt2_edit').val(),
                Miennui2: $('#mn2_edit').val(),

                Namapdung3: $('#nam3_edit').val(),
                Thanhthi3: $('#tt3_edit').val(),
                Nongthon3: $('#nt3_edit').val(),
                Miennui3: $('#mn3_edit').val(),

                Mahs: $('#Mahs_edit').val()
            },
            dataType: 'JSON',
            success: function(data) {
                if (data.status == 'success') {
                    toastr.success("Cập nhật thông tin thành công!", "Thành công");
                    $('#frm_data').replaceWith(data.message);
                    $(document).ready(function() {
                        TableManaged4.init();
                    });
                    $('#Edit_Modal').modal("hide");
                } else {
                    toastr.error(data.message, "Lỗi!");
                }
            }
        })
    }

    function GetDelete(id) {

        document.getElementById("id_delete").value = id;
    }

    function SetDelete() {
        $.ajax({
            url: '/DinhGiaGdDtCt/Delete',
            type: 'POST',
            data: {
                Id: $('#id_delete').val(),
            },
            dataType: 'JSON',
            success: function(data) {
                if (data.status == 'success') {
                    $('#frm_data').replaceWith(data.message);
                    $(document).ready(function() {
                        TableManaged4.init();
                    });
                    toastr.success("Cập nhật thành công!!!", "Thành công!");
                    $('#Delete_Modal').modal("hide");
                } else {
                    toastr.error(data.message, "Lỗi!");
                }
            }
        })
    }
</script>



